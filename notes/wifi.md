# 关于家庭 Wi-Fi 的一些经验

讨论局限在家庭宽带

家庭宽带最重要的功能是**是否有公网IPv4**

如果有，那么有很多玩法

如果没有，那倒也简化了很多问题


## 先解释几个概念：
- 路由器/路由/端口转发/DMZ/UPnP是**层3**的事
- 交换机/网桥/AP/Wi-Fi Mesh是**层2**的事

如果有公网IPv4，那么让光猫工作在桥接模式，用自己的路由器拨号，自己管理整个层3，获得更多的功能

如果没有公网IPv4，那么让光猫工作在路由模式，自己只操心层2的事情，图个便利

如果装修没有布网线到房间，那只能在弱电箱附近放一个大功率无线路由器（有公网）或者大功率企业级AP（无公网）

如果有网线到房间，那么用多个小功率 Wi-Fi Mesh 漫游覆盖代替单点大功率穿墙会获得更好体验

如果还没买设备，那么买**带AC的POE交换机+面板AP**（有公网）或者 **POE交换机+带Mesh的面板AP**（无公网）

如果已经有不同品牌的设备，例如运营商送的中兴/华为/其他杂牌的无线路由器，那互相换换凑成同品牌的，或者挂闲鱼出掉然后换上一条方案

如果已经有同品牌的支持Mesh的设备了，那就用着吧

## 下面讨论几个典型场景：

### 有公网，有网线，有Mesh路由器：
光猫和主路由器放弱电箱，主路由器WAN口接光猫+拨号，LAN 口接网线到房间，其他路由器按照手册配置成 Mesh 模式。

这个方法要在弱电箱里面放两个设备，

### 无公网，有网线，有Mesh路由器：
拨号的光猫放弱电箱，光猫的LAN口接网线到每个房间，第一个路由器上电，网线插WAN口，配置成**有线中继**模式，或者叫**AP模式** / **接入点模式** 。
再将第二个路由器上电，重置出厂模式，然后网线插WAN口，稍等片刻将会自动配置成 Mesh 模式组网。
照着第二个路由器一样搞好小三小四路由器。

这个方法弱电箱里面只放光猫，电信的工人通常不会这个路子，别被他们忽悠了。

有些品牌比较坑爹，不支持**AP模式**，挂闲鱼之

### 有网线，有POE交换机和面板AP：
光猫和 POE 交换机放弱电箱，交换机 LAN 口接每个房间的面板 AP。想利用公网 IP 就买带 AC 功能的交换机自己拨号，否则就买更便宜的纯 POE 交换机。

## 关于 OpenWRT 的几点想法：

如果我们需要一个可以24*7的运行的小服务器，有比 openwrt 更合适的选择，包括但不限于软路由。

用 openwrt 是图什么呢？如果是为了 wireless 的性能，那还是商用的闭源驱动更好。

如果是为了 wireless 的功能，例如 802.11kvr， 那确实 openwrt + 开源驱动有优势。

可是，这样的场景其实很少很少。

而且各家网卡的开源驱动支持差距很大，所以在买路由器的时候要仔细选无线芯片，比如尽量避免brcm的芯片。
